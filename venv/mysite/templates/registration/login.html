{% extends 'accounts/base.html' %}
{% load static %}
{% block customcss %}

{% endblock customcss %}
{% block header %}
{% endblock header %}
{% block content %}
<html>
<head>
<link rel='stylesheet'  href="./../../static/css/style.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ログイン画面</title>
</head>
  <body>
    <form action="{% url  'twoAuth' %}" method="POST" id="kintai" name="kintai">
    {% csrf_token %}
                            <table class="tbl_title" width="80%" style="text-align:center">
                                <tr>
                                    <td colspan="2" class="title">ログイン</td>
                                </tr>
                                <tr>
                                        <td class="lbl_title">

                                        <span id="lblUserId">社員CD:</span>
                                        <input name="User" type="text" id="txtUserId" tabindex="1" class="txt_code" style="width:150px;" />
                                    </td>
                                </tr>
                                <tr>
                                        <td class="lbl_title">
                                        <span id="lblPassword">パスワード:</span>
                                        <input name="Pass" type="password" id="txtPassword" tabindex="2" class="txt_code" style="width:150px;" />&nbsp;

                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <span id="lblErrMsg" class="lbl_error" style="color:red">{{ error }}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <button type="submit"  style="width:200px">ログイン</button>
</form>

                                    </td>
                                </tr>
                               <tr>
                                    <td>
                                        <form method="POST"  action="{% url  'password' %}" name="password">
                                        {% csrf_token %}
                                          <button type="submit"  style="width:200px">パスワード変更</button>
                                        </form>
                                    </td>

                                </tr>
                                      {% if  auth %}
                                            <dialog open id="dig">
                                                <p>SMSに送られた認証コードを入力してください。</p>
                                                <input name="authv" type="hidden" id="authv" value="{{ auth }}" tabindex="1"  style="width:150px;" />
                                                <form action="{% url  'koutuhi' %}"  method="POST" id="kintai" name="kintai" onsubmit="return twoAuth()">
                                                {% csrf_token %}
                                                <input name="auth" type="text" id="auth" value="" tabindex="1"  style="width:150px;" />
                                                <input name="User" id="User" type="hidden" maxlength="8" value="{{ user }}" >
                                                <button>送信</button>
                                                </form>
                                                <form id="form" onsubmit="return cancelsubmit()">
                                                <button onclick="cancelsubmit()">閉じる</button>
                                                </form>
                                                <div id="miss" value=""></div>
                                            </dialog>

                                    {% endif %}

                             </table>
  </body>
<script language="javascript" type="text/javascript">
var misscount = 0;
        function twoAuth() {
            console.log(document.getElementById('auth').value)
            console.log(misscount)

            if(document.getElementById('auth').value == document.getElementById('authv').value){
               misscount = 0;
               window.open("{% url  'kintai' %}");
               return true;
            }
            misscount = misscount + 1;
            if(misscount == 3) {
                document.getElementById('dig').close();
                misscount = 0;
                return true;
            }
            document.getElementById("miss").innerHTML = '認証コードが違います'
            return false;
        }

        function cancelsubmit() {
            misscount = 0;
            document.getElementById('dig').close();
            return false;
        }



</script>
</html>
{% endblock content %}