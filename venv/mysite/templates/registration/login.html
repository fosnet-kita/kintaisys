{% extends 'accounts/base.html' %}
{% load static %}
{% block customcss %}
    
{% endblock customcss %}
{% block header %}
{% endblock header %}
{% block content %}
<html>
<head>
<link rel='stylesheet'  href="./../../static/css/style.css">
<title>ログイン画面</title>
</head>
  <body>
    <form action="{% url  'twoAuth' %}" method="POST" id="kintai" name="kintai">
    {% csrf_token %}
    <table width="50%" >
    {% csrf_token %}
                        <tr>
                        <td>
                            <table class="tbl_title" width="100%" style="text-align:center">
                                <tr>
                                    <td colspan="2" class="title">ログイン</td>
                                </tr>
                                <tr>
	                                <td class="lbl_title">
	                                    
                                        <span id="lblUserId">ユーザーID:</span>
                                        <input name="User" type="text" id="txtUserId" tabindex="1" class="txt_code" style="width:150px;" />
                                    </td>
                                </tr>
                                <tr>
	                                <td class="lbl_title">
                                        <span id="lblPassword">パスワード:</span>
                                        <input name="Pass" type="password" id="txtPassword" tabindex="2" class="txt_code" style="width:150px;" />&nbsp;
                                        
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <span id="lblErrMsg" class="lbl_error" style="color:red">{{ error }}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <button type="submit"  style="width:200px">ログイン</button>
</form>
                                     {% if  auth %}
                                            <dialog open id="dig">
                                                <p>メールに送られた認証コードを入力してください。</p>
                                                {{ auth }}
                                                <input name="authv" type="hidden" id="authv" value="{{ auth }}" tabindex="1"  style="width:150px;" />
                                                <form action="{% url  'koutuhi' %}" target="formpost" method="POST" id="kintai" name="kintai" onsubmit="return twoAuth()">
                                                {% csrf_token %}
                                                <input name="auth" type="text" id="auth" value="" tabindex="1"  style="width:150px;" />
                                                <button>送信</button>
                                                </form>
                                                <form id="form" action="test" method="post" onsubmit="return cancelsubmit()">
                                                <button>閉じる</button>
                                                </form>
                                                <div id="miss" value=""></div>
                                            </dialog>
                                     
                                    {% endif %}
                                    
                                    </td>
                                </tr>                              
                               <tr>
                                    <td>                                     
                                        <form method="POST"  action="{% url  'password' %}" name="password">
                                        {% csrf_token %}
                                          <button type="submit"  style="width:200px">パスワード変更</button>
                                        </form>
                                    </td>
                                    
                                </tr>
                             </table>
                        </td>
                    </tr>
                 </table>

  </body>
<script language="javascript" type="text/javascript">
var misscount = 0;
        function twoAuth() {
            console.log(document.getElementById('auth').value)
            console.log(misscount)
            
            if(document.getElementById('auth').value == document.getElementById('authv').value){
               misscount = 0;
               window.open('','formpost');
               var form = document.kintai;
               form.action = "{% url  'kintai' %}";
               form.target = 'formpost';
               form.method = 'post';
               return true;
            }
            misscount = misscount + 1;
            if(misscount == 3) {
                document.getElementById('dig').close();
                misscount = 0;
                return true;
            }
            document.getElementById("miss").innerHTML = '認証コードが違います'
            return false;
        }
        
        function cancelsubmit() {
            misscount = 0;
            document.getElementById('dig').close();
            return false;
        }



</script>
</html>
{% endblock content %}